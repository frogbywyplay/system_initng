INCLUDE_DIRECTORIES( ${CMAKE_SOURCE_DIR}/src ${CMAKE_BINARY_DIR} )

ADD_LIBRARY(ngc4 MODULE initng_ngc4.c)
INSTALL_TARGETS(${LIB_INSTALL_DIR}/initng ngc4)

ADD_LIBRARY(ngcclient SHARED libngcclient.c)
SET_TARGET_PROPERTIES(ngcclient PROPERTIES VERSION 0.0.0 SOVERSION 0)
INSTALL_TARGETS(${LIB_INSTALL_DIR} ngcclient)

ADD_EXECUTABLE(ngc ngc4.c)
SET_TARGET_PROPERTIES(ngc PROPERTIES COMPILE_FLAGS "-fPIE -fstack-protector-all")
SET_TARGET_PROPERTIES(ngc PROPERTIES LINK_FLAGS "-pie")
TARGET_LINK_LIBRARIES(ngc ngcclient)

IF(BUILD_NGE)
	LINK_DIRECTORIES(${CMAKE_BINARY_DIR}/plugins/nge)
	INCLUDE_DIRECTORIES(${CMAKE_SOURCE_DIR}/plugins/nge)
	ADD_DEFINITIONS(-DHAVE_NGE)
	TARGET_LINK_LIBRARIES(ngc ngeclient)
ENDIF(BUILD_NGE)

SET_TARGET_PROPERTIES(ngc PROPERTIES POST_INSTALL_SCRIPT
	${CMAKE_CURRENT_BINARY_DIR}/create_links.cmake)
INSTALL_TARGETS(${SBIN_INSTALL_DIR} ngc)


INSTALL_FILES(${INCLUDE_INSTALL_DIR}/initng FILES libngcclient.h initng_ngc4.h)

CONFIGURE_FILE(
	"${CMAKE_CURRENT_SOURCE_DIR}/create_links.cmake.in"
	"${CMAKE_CURRENT_BINARY_DIR}/create_links.cmake"
	IMMEDIATE @ONLY)
